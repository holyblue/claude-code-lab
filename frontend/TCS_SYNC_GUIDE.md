# TCS 同步功能使用指南

## 📋 功能概述

TCS 同步功能讓您可以一鍵將本系統的工時記錄同步到 TCS 系統，無需手動複製貼上。

### 主要特色

- ✅ **一鍵同步**: 點擊浮動按鈕即可同步
- ✅ **預覽模式**: 同步前可先預覽，確保資料正確
- ✅ **錯誤處理**: 詳細的錯誤訊息和重試機制
- ✅ **同步日誌**: 自動記錄所有同步操作
- ✅ **重複同步**: 可以對同一天重複同步（覆蓋 TCS 資料）

## 🚀 快速開始

### 1. 找到同步按鈕

在系統任何頁面，您都會看到右下角的**藍色浮動按鈕**（上傳圖示）。

```
                    [🔼]  ← 這個藍色圓形按鈕
                    
```

### 2. 點擊同步按鈕

點擊後會彈出「同步工時到 TCS」對話框。

### 3. 選擇日期

- 預設顯示**今天**的日期
- 可以選擇其他日期
- 選擇後會自動載入該日期的工時記錄

### 4. 查看工時記錄

對話框會顯示：
- 📊 當日工時記錄（X 筆，共 Y 小時）
- 每筆記錄的專案、說明、工時
- ⚠️ 警告訊息：將覆蓋 TCS 該日現有資料

### 5. 選擇操作

您有三個選擇：

#### 選項 A: 預覽（推薦）
- 點擊「**預覽 (不寫入)**」按鈕
- 系統會模擬同步過程，但**不會真正寫入** TCS
- 顯示預覽結果，包含驗證結果
- 確認無誤後，可點擊「確認真正同步」

#### 選項 B: 直接同步
- 點擊「**確認同步**」按鈕
- 直接將資料寫入 TCS 系統
- 顯示同步結果（成功/失敗）

#### 選項 C: 取消
- 點擊「**取消**」按鈕
- 關閉對話框，不執行任何操作

## 📖 詳細操作流程

### 預覽模式（推薦使用）

```
1. 點擊浮動按鈕
   ↓
2. 選擇日期（預設今天）
   ↓
3. 點擊「預覽 (不寫入)」
   ↓
4. 查看預覽結果
   - ✓ 日期、記錄數、總工時
   - ✓ 驗證結果（專案代碼、模組、工作類別等）
   ↓
5. 確認無誤後，點擊「確認真正同步」
   ↓
6. 完成！顯示成功訊息
```

### 直接同步模式

```
1. 點擊浮動按鈕
   ↓
2. 選擇日期（預設今天）
   ↓
3. 點擊「確認同步」
   ↓
4. 等待同步完成
   ↓
5. 完成！顯示成功訊息
```

## ⚠️ 重要注意事項

### 1. 同步會覆蓋 TCS 資料

- 同步操作會**覆蓋** TCS 該日期的現有資料
- 建議先使用「預覽」模式確認資料正確
- 可以重複同步以更新資料

### 2. 一次只同步一天

- 本功能設計為**一次同步一天**的工時
- 如需同步多天，請分別選擇日期進行

### 3. 需要內網環境

- TCS 系統只能在內網訪問
- 在外網環境會同步失敗

### 4. 資料完整性檢查

系統會自動檢查：
- ✓ 專案代碼是否有效
- ✓ 模組代碼是否有效（如果有填）
- ✓ 工作類別是否有效
- ✓ 總工時是否超過 18 小時
- ✓ 必填欄位是否完整

## 🔧 錯誤處理

### 常見錯誤及解決方法

#### 錯誤 1: 找不到工時記錄

**錯誤訊息**: 該日期沒有工時記錄

**解決方法**:
1. 檢查是否有輸入該日期的工時
2. 確認日期選擇是否正確

#### 錯誤 2: 無法連接 TCS 系統

**錯誤訊息**: 無法連接 TCS 系統 (http://cfcgpap01)

**可能原因**:
- 不在內網環境
- TCS 系統維護中
- 網路連接問題

**解決方法**:
1. 確認在內網環境
2. 檢查 TCS 系統是否正常運作
3. 稍後重試

#### 錯誤 3: 資料驗證失敗

**錯誤訊息**: 資料驗證失敗: XXX

**可能原因**:
- 專案代碼、模組或工作類別無效
- 總工時超過 18 小時限制
- 必填欄位缺失

**解決方法**:
1. 檢查工時記錄的專案、模組、工作類別是否正確
2. 檢查總工時是否合理
3. 確認所有必填欄位已填寫

#### 錯誤 4: Playwright 執行失敗

**錯誤訊息**: Playwright 執行失敗: XXX

**可能原因**:
- 後端 Playwright 未正確安裝
- 瀏覽器驅動問題
- TCS 系統頁面結構變更

**解決方法**:
1. 聯繫系統管理員
2. 查看錯誤日誌詳情

### 查看錯誤詳情

當同步失敗時，錯誤對話框會顯示：
- 錯誤時間
- 目標日期
- 錯誤類型
- 可能原因
- 錯誤詳情（可展開）
- 建議操作

您可以：
- 點擊「**複製錯誤訊息**」複製技術資訊
- 點擊「**重試**」再次嘗試同步
- 點擊「**關閉**」關閉對話框

## 📊 同步日誌

系統會自動記錄所有同步操作：

### 日誌內容
- 操作時間
- 目標日期
- 操作狀態（成功/失敗/預覽）
- 填寫記錄數
- 錯誤訊息（如果失敗）

### 日誌儲存
- 日誌儲存在瀏覽器 localStorage
- 最多保留 **50 筆**記錄
- 可以查看最近的同步歷史

## 💡 使用技巧

### 技巧 1: 先預覽再同步

建議每次都先使用「預覽」模式：
1. 確認資料格式正確
2. 檢查專案代碼、模組等是否有效
3. 確認總工時合理
4. 然後再進行真正同步

### 技巧 2: 當日工時填寫完畢後再同步

- 建議在一天結束時，確認所有工時都填寫完成後再同步
- 避免多次重複同步

### 技巧 3: 檢查已同步狀態

- 如果日期已經同步過，對話框會顯示「✓ 此日期已同步過」
- 可以放心重複同步以更新資料

### 技巧 4: 利用快捷鍵

在對話框中：
- `Enter` 鍵：確認同步
- `Esc` 鍵：取消

## 🎨 UI 說明

### 浮動按鈕狀態

| 狀態 | 外觀 | 說明 |
|------|------|------|
| 正常 | 藍色圓形按鈕 | 可以點擊 |
| 同步中 | 旋轉動畫 | 正在同步，請稍候 |
| Hover | 按鈕上浮 | 滑鼠懸停效果 |

### 對話框元素

- **日期選擇器**: 選擇要同步的日期
- **工時記錄列表**: 顯示該日期的所有記錄
- **統計資訊**: 顯示記錄數和總工時
- **警告訊息**: 提醒會覆蓋 TCS 資料
- **操作按鈕**: 取消/預覽/確認同步

## 🔒 安全性說明

### 預設保護機制

1. **預覽模式**: 預設使用 dry_run 模式，不會真正寫入
2. **確認機制**: 真正同步前會顯示警告
3. **錯誤處理**: 詳細的錯誤訊息和日誌

### 資料保護

- 同步操作只影響 TCS 系統
- 本系統的資料不會被修改
- 可以重複同步以恢復資料

## 📱 響應式設計

- **桌面**: 浮動按鈕位於右下角（56×56px）
- **平板/手機**: 按鈕稍小（48×48px），位置調整

## ❓ 常見問題 FAQ

### Q1: 可以同步多天的資料嗎？

**A**: 目前設計為一次同步一天，如需同步多天，請分別操作。

### Q2: 同步後可以撤銷嗎？

**A**: 同步操作無法撤銷，但可以重新同步以覆蓋資料。

### Q3: 同步會影響本系統的資料嗎？

**A**: 不會，同步只會將資料寫入 TCS，不影響本系統。

### Q4: 預覽模式會寫入 TCS 嗎？

**A**: 不會，預覽模式（dry_run）只是模擬，完全不會寫入 TCS。

### Q5: 同步失敗後資料會怎樣？

**A**: 本系統資料不受影響，TCS 資料也不會部分寫入。

### Q6: 可以在外網使用嗎？

**A**: 不行，TCS 系統只能在內網訪問。

### Q7: 同步需要多久？

**A**: 通常 3-10 秒，取決於記錄數量和網路速度。

### Q8: 可以查看同步歷史嗎？

**A**: 可以，系統會在 localStorage 保留最近 50 筆日誌。

## 📞 技術支援

如遇到問題：

1. **查看錯誤訊息**: 點擊「複製錯誤訊息」
2. **查看同步日誌**: 檢查 localStorage 中的日誌
3. **聯繫管理員**: 提供錯誤訊息和操作步驟

---

**版本**: 1.0.0  
**最後更新**: 2025-11-25  
**維護**: 開發團隊

